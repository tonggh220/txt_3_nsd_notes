#####DBA1_DAY04   主机50  主机51

1 用户授权： 在数据库服务器里添加新用户 给客户端连接时使用。
             默认只有数据库管理root 用户 在本机自己访问自己机器的数据库服务。

      1.1 用户授权 
		命令格式 grant 
  grant  权限列表  on   库名  to  用户名@"客户端地址"  
           identified  by  "密码"  		//授权用户密码
           with  grant  option ;    		//有授权权限 ,可选项
          

      例子50添加用户
mysql> grant all on db4.* to yaya@"%" identified by "123qqq...A";

mysql> grant all on *.* to  mydba@"%" identified by "123qqq...A" with grant option;

mysql> select user,host from  mysql.user;

      测试51主机测试添加的用户
 host51]# mysql -h192.168.4.50 -uyaya -p123qqq...A   
 mysql> select user();
 mysql> select @@hostname;
 mysql> show grants;
 mysql> create database db4;

host51]# mysql -h192.168.4.50 -umydba -p123qqq...A   
mysql> grant select on db1.* to admin2@"localhost" identified by "123qqq...A";
mysql> exit

50]# mysql -uadmin2 -p123qqq...A




      1.2 撤销权限 (删除已有用户的权限)
revoke 权限列表 on  数据库名 from  用户名@"客户端地址";

50]#mysql -uroot -p密码
查看已有的授权用户  select user,host from mysql.user;
查看已有用户的访问权限 show grants for 用户名@"客户端地址";

#删除用户的权限
mysql> revoke delete on db4.* from  yaya@"%";
mysql> revoke update , drop  on db4.* from  yaya@"%";
mysql> revoke all on db4.* from  yaya@"%";

drop user yaya@"%"; #删除用户

  
用户授权补充  

host50]#  
 mysql> grant all on db3.* to plj@"192.168.4.%" identified by "123qqq...A" with grant option;

 mysql> grant insert on mysql.* to plj@"192.168.4.%";

 mysql> revoke grant option on  *.* from mydba@"%";

 mysql> grant all on  *.*  to  root@"192.168.4.51" identified by "666888" with grant option;


 mysql> delete from mysql.user where user="root" and host="localhost";
 mysql> flush privileges;


host51]# mysql -h192.168.4.50 -uplj -p123qqq...A
mysql>grant all on db3.*  to  plj88@"%" identified by "123qqq...A";


host51]#mysql -h192.168.4.50 -uroot -p666888
mysql> grant all on  *.*  to root@"localhost" identified by "123456" WITH GRANT OPTION;
 
  相关命令：
	授权用户登录后修改自己的登录密码
               mysql> set password=password("abc123");

	数据库管理员重置授权用户的密码
		mysql> set password for mydba@"%"=password("123456");

       查看已有用户的访问权限
        mysql> show grants for plj@"192.168.4.%";


  授权库 MySQL 存储授权信息,查看表记录可以获取用户权限；也可以通过更新记录，修改用户权限
         要了解表中的表头有哪些 分别存储的是什么授权信息
         练习+休息 20分钟到  11:25

user表		记录已有的授权用户及权限（all  *.*）

mysql> grant all on *.*  to admin4@"%" identified by "123456";

mysql> update mysql.user set grant_priv="Y" where host="%" and user="admin4";
mysql> flush privileges;
mysql> select  * from  mysql.user \G
mysql> show grants for admin4@"%";


db表		 记录已有授权用户对数据库的访问权限 (库名.*)   db3.*  mysql.*

desc mysql.db;

mysql> select host,user,db from mysql.db;

mysql> select  * from mysql.db where db="db3" and user="plj88" and host="%" \G

mysql> update mysql.db set update_priv="N" , delete_priv="N" where db="db3" and user="plj88" and host="%";

mysql> flush privileges;

mysql> show grants for plj88@"%";

  

tables_priv表	 记录已有授权用户对表的访问权限（库名.表名）

desc mysql.tables_priv;

select  * from mysql.tables_priv \G

mysql> update mysql.tables_priv set Table_priv="select,delete" where Table_name="user" and user="admin3";

mysql> flush privileges;

mysql> select  * from mysql.tables_priv \G

mysql> show grants for admin3@"%";

mysql> select user , table_name from mysql.tables_priv where table_name="user";



columns_priv表	记录已有授权用户对字段的访问权限（  update(name,age) ）

mysql> grant select,update(name)  on  db3.user to admin3@"%" identified by "123456";
mysql> select  * from  columns_priv;



      1.4 破解数据库管理员本机登录密码
		修改主配置文件
]# vim /etc/my.cnf
[mysqld]
skip-grant-tables

#validate_password_policy=0
#validate_password_length=6
:wq

		重启mysqld服务
】#systemctl restart mysqld

                无密码登录
[root@localhost ~]# mysql
MySQL>
               
                修改密码 断开连接

mysql> desc  mysql.user;

mysql> select  host,user,authentication_string from mysql.user;

mysql> update mysql.user set  authentication_string=password("123qqq...A")
    -> where user="root" and host="localhost";

mysql> flush privileges;

mysql> exit


                还原配置文件， 重启mysqld服务
[mysqld]
#skip-grant-tables
validate_password_policy=0
validate_password_length=6
:wq

]# systemctl restart mysqld


                使用修改后的密码连接服务
]# mysql -uroot -p123qqq...A