1 用户授权：
		定义：使用数据库管理登录后，添加新的用户 并设置访问权限及登录密码
		      （默认只有数据库管理员root 用户可以 本机自己访问自己）
	
		命令格式： grant 
 grant 权限列表 on  数据库名  to  用户名@"客户端地址" identified by  "密码"  [ with grant option]；
 

		参数介绍
			权限列表 (可以执行的命令 命令之间是有,间隔)
			数据库名的表示方式?
			用户名  客户端访问数据库服务器时使用的名字 自定义即可，存储在mysql库下的user表里。
 
			客户端地址的表示方式 ？

			identified by   连接密码（要符合密码策略）
                        with grant option  可选项， 让新添加的用户有使用grant命令的权限

                例子

  grant  all   on  db1.*   to  admin@"%"  identified by "123qqq...A";

  
 客户端使用授权用户连接数据库服务器
 ]# which mysql
 ]# mysql -h数据库服务器ip地址 -u授权用户名  -p密码



 ++++++++++
添加用户mydba，对所有库、表有完全权限允许从任何客户端连接，密码123qqq…A 且有授权权限

 grant all on  *.*  to mydba@"%" identified by "123qqq...A" with grant option ;


+++++++++++ 练习到 11:40
添加admin用户，允许从192.168.4.0/24网段连接，对db3库的user表有查询权限，密码123qqq…A

mysql> grant select  on  db3.user  to  admin@"192.168.4.%" identified by "123qqq...A" ;

添加admin2用户，允许从本机连接，允许对db3库的所有表有查询/更新/插入/删除记录权限，密码123qqq…A
mysql> grant select,insert,update,delete on db3.* to admin2@"localhost" identified by "123qqq...A";

                相关命令
                        删除授权用户
                        drop user 用户名@"客户端地址"；
                        登录用户查看自己的访问权限 show grants;

                        查看服务器已有的授权用户
                      select user , host  from mysql.user;

mysql> select user  , host  from mysql.user;
+-----------+-------------+
| user      | host        |
+-----------+-------------+
| admin     | %           |
| mydba     | %           |
| admin     | 192.168.4.% |
| admin2    | localhost   |
| mysql.sys | localhost   |
| root      | localhost   |
+-----------+-------------+
6 rows in set (0.00 sec)

mysql>

                        管理员查看已有授权用户权限

mysql> show grants for mydba@"%";
mysql>

                        授权用户登录后修改自己的连接密码

[root@host51 ~]# mysql  -h192.168.4.50 -uadmin  -p123qqq...A
MySQL [(none)]> select  password("456qqq...B");
+-------------------------------------------+
| password("456qqq...B")                    |
+-------------------------------------------+
| *5CD115DAC51FB57FD4F6AF18A3AB8B91642A7601 |
+-------------------------------------------+
1 row in set, 1 warning (0.00 sec)

                   管理员重置授权用户连接密码
[root@host50 ~]# mysql -uroot -p123qqq...A
mysql> set password for admin@"192.168.4.%"=password("123qqq...A");
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql>
[root@host51 ~]# mysql  -h192.168.4.50 -uadmin  -p456qqq...B
ERROR 1045 (28000): Access denied for user 'admin'@'192.168.4.51' (using password: YES)
[root@host51 ~]#
[root@host51 ~]# mysql  -h192.168.4.50 -uadmin  -p123qqq...A
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 13
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]>


++++++++++++++++++++++++++++mysql库 记录授权信息，主要表如下：

              +++++++++++++++++  user表  记录已有的授权用户及权限（all  *.*）

select user from mysql.user;

select  host , user  from mysql.user;

select  * from mysql.user where  user="mydba" and host="%"  \G

show grants for mydba@"%" ;

mysql> update mysql.user set  Grant_priv="N" where  user="mydba" and host="%";
Query OK, 1 row affected (0.05 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for mydba@"%";
+--------------------------------------------+
| Grants for mydba@%                         |
+--------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'mydba'@'%' |
+--------------------------------------------+
1 row in set (0.00 sec)

mysql> select * from mysql.user where  host="%" and user="mydba" \G
*************************** 1. row ***************************
                  Host: %
                  User: mydba
           Select_priv: Y
           Insert_priv: Y
           Update_priv: Y
           Delete_priv: Y
           Create_priv: Y
             Drop_priv: Y
           Reload_priv: Y
         Shutdown_priv: Y
      Lock_tables_priv: Y
          Execute_priv: Y
       Repl_slave_priv: Y
      Repl_client_priv: Y
      Create_view_priv: Y
        Show_view_priv: Y
   Create_routine_priv: Y
    Alter_routine_priv: Y
      Create_user_priv: Y
            Event_priv: Y
          Trigger_priv: Y
Create_tablespace_priv: Y
              ssl_type:
            ssl_cipher:
           x509_issuer:
          x509_subject:
         max_questions: 0
           max_updates: 0
       max_connections: 0
  max_user_connections: 0
                plugin: mysql_native_password
 authentication_string: *F19C699342FA5C91EBCF8E0182FB71470EB2AF30
      password_expired: N
 password_last_changed: 2020-06-22 18:33:32
     password_lifetime: NULL
        account_locked: N
1 row in set (0.01 sec)

mysql

mysql> update  mysql.user set select_priv="N" , delete_priv="N"
    -> where user="mydba" and host="%";
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for mydba@"%";
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Grants for mydba@%                                                                                                                                                                                                                                                                                                                      |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| GRANT INSERT, UPDATE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE ON *.* TO 'mydba'@'%' |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> 


+++++++++++++++++++

db表                    记录已有授权用户对数据库的访问权限 (库名.*) db3.*

mysql> desc mysql.db;
mysql> select host , user , db  from mysql.db;
+-----------+-----------+-----+
| host      | user      | db  |
+-----------+-----------+-----+
| localhost | admin2    | db3 |
| localhost | mysql.sys | sys |
+-----------+-----------+-----+
2 rows in set (0.00 sec)

mysql> select *  from mysql.db where db="db3" \G
*************************** 1. row ***************************
                 Host: localhost
                   Db: db3
                 User: admin2
          Select_priv: Y
          Insert_priv: Y
          Update_priv: Y
          Delete_priv: Y
          Create_priv: N
            Drop_priv: N
           Grant_priv: N
      References_priv: N
           Index_priv: N
           Alter_priv: N
Create_tmp_table_priv: N
     Lock_tables_priv: N
     Create_view_priv: N
       Show_view_priv: N
  Create_routine_priv: N
   Alter_routine_priv: N
         Execute_priv: N
           Event_priv: N
         Trigger_priv: N
1 row in set (0.00 sec)

mysql> show grants for admin2@"localhost";
+-------------------------------------------------------------------------+
| Grants for admin2@localhost                                             |
+-------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin2'@'localhost'                              |
| GRANT SELECT, INSERT, UPDATE, DELETE ON `db3`.* TO 'admin2'@'localhost' |
+-------------------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>
mysql> update mysql.db set  delete_priv="N" where db="db3";
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush  privileges;
Query OK, 0 rows affected (0.00 sec)

mysql>
mysql> show grants for admin2@"localhost";
+-----------------------------------------------------------------+
| Grants for admin2@localhost                                     |
+-----------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin2'@'localhost'                      |
| GRANT SELECT, INSERT, UPDATE ON `db3`.* TO 'admin2'@'localhost' |
+-----------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>
mysql> select  * from mysql.db where db="db3" \G
*************************** 1. row ***************************
                 Host: localhost
                   Db: db3
                 User: admin2
          Select_priv: Y
          Insert_priv: Y
          Update_priv: Y
          Delete_priv: N
          Create_priv: N
mysql> show grants for admin2@"localhost";
+-----------------------------------------------------------------+
| Grants for admin2@localhost                                     |
+-----------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin2'@'localhost'                      |
| GRANT SELECT, INSERT, UPDATE ON `db3`.* TO 'admin2'@'localhost' |
+-----------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>
mysql> select  * from mysql.db where db="db3" \G
*************************** 1. row ***************************
                 Host: localhost
                   Db: db3
                 User: admin2
          Select_priv: Y
          Insert_priv: Y
          Update_priv: Y
          Delete_priv: N
          Create_priv: N
            Drop_priv: N
           Grant_priv: N
      References_priv: N
           Index_priv: N
           Alter_priv: N
Create_tmp_table_priv: N
     Lock_tables_priv: N
     Create_view_priv: N
       Show_view_priv: N
  Create_routine_priv: N
   Alter_routine_priv: N
         Execute_priv: N
           Event_priv: N
         Trigger_priv: N
1 row in set (0.00 sec)

mysql>

++++++++++++++++++++++++++++++++++++++++
tables_priv表   记录已有授权用户对表的访问权限  (库名.表名) db1.stu

mysql> select  user , db, table_name from  mysql.tables_priv ;
+-----------+-----+------------+
| user      | db  | table_name |
+-----------+-----+------------+
| admin     | db3 | user       |
| mysql.sys | sys | sys_config |
+-----------+-----+------------+
2 rows in set (0.00 sec)

mysql> select  host ,user , db, table_name from  mysql.tables_priv ;
+-------------+-----------+-----+------------+
| host        | user      | db  | table_name |
+-------------+-----------+-----+------------+
| 192.168.4.% | admin     | db3 | user       |
| localhost   | mysql.sys | sys | sys_config |
+-------------+-----------+-----+------------+
2 rows in set (0.00 sec)

mysql> select  * from  mysql.tables_priv where db="db3" and table_name="user" ;
mysql> select  * from  mysql.tables_priv where db="db3" and table_name="user" ;
+-------------+-----+-------+------------+----------------+---------------------+------------+-------------+
| Host        | Db  | User  | Table_name | Grantor        | Timestamp           | Table_priv | Column_priv |
+-------------+-----+-------+------------+----------------+---------------------+------------+-------------+
| 192.168.4.% | db3 | admin | user       | root@localhost | 0000-00-00 00:00:00 | Select     |             |
+-------------+-----+-------+------------+----------------+---------------------+------------+-------------+
1 row in set (0.00 sec)

mysql> show grants for admin@"192.168.4.%";
+-------------------------------------------------------+
| Grants for admin@192.168.4.%                          |
+-------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin'@'192.168.4.%'           |
| GRANT SELECT ON `db3`.`user` TO 'admin'@'192.168.4.%' |
+-------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>


mysql> update mysql.tables_priv set  table_priv="select,insert,update" where db="db3" and table_name="user";
Query OK, 1 row affected (0.03 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for admin@"192.168.4.%";
+-----------------------------------------------------------------------+
| Grants for admin@192.168.4.%                                          |
+-----------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin'@'192.168.4.%'                           |
| GRANT SELECT, INSERT, UPDATE ON `db3`.`user` TO 'admin'@'192.168.4.%' |
+-----------------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql> select  * from  mysql.tables_priv where db="db3" and table_name="user" ;
+-------------+-----+-------+------------+----------------+---------------------+----------------------+-------------+
| Host        | Db  | User  | Table_name | Grantor        | Timestamp           | Table_priv           | Column_priv |
+-------------+-----+-------+------------+----------------+---------------------+----------------------+-------------+
| 192.168.4.% | db3 | admin | user       | root@localhost | 2020-06-22 23:49:14 | Select,Insert,Update |             |
+-------------+-----+-------+------------+----------------+---------------------+----------------------+-------------+
1 row in set (0.00 sec)

mysql>

++++++++++++++++++++++++=
columns_priv表  记录已有授权用户对字段的访问权限 update(name,age)

mysql> select  * from  mysql.columns_priv;
Empty set (0.00 sec)

mysql> desc  mysql.columns_priv;


mysql> grant  select , update(name,uid) on db3.user to yaya@"%" identified by "123qqq...A";
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> select  * from  mysql.columns_priv;
+------+-----+------+------------+-------------+---------------------+-------------+
| Host | Db  | User | Table_name | Column_name | Timestamp           | Column_priv |
+------+-----+------+------------+-------------+---------------------+-------------+
| %    | db3 | yaya | user       | name        | 0000-00-00 00:00:00 | Update      |
| %    | db3 | yaya | user       | uid         | 0000-00-00 00:00:00 | Update      |
+------+-----+------+------------+-------------+---------------------+-------------+
2 rows in set (0.00 sec)

mysql> mysql> select  * from  mysql.tables_priv;
+-------------+-----+-----------+------------+----------------+---------------------+----------------------+-------------+
| Host        | Db  | User      | Table_name | Grantor        | Timestamp           | Table_priv           | Column_priv |
+-------------+-----+-----------+------------+----------------+---------------------+----------------------+-------------+
| localhost   | sys | mysql.sys | sys_config | root@localhost | 2020-06-19 17:29:39 | Select               |             |
| %           | db3 | yaya      | user       | root@localhost | 0000-00-00 00:00:00 | Select               | Update      |
| 192.168.4.% | db3 | admin     | user       | root@localhost | 2020-06-22 23:49:14 | Select,Insert,Update |             |
+-------------+-----+-----------+------------+----------------+---------------------+----------------------+-------------+
3 rows in set (0.00 sec)

mysql>

MySQL [(none)]> update  db3.user set password="F" ;
ERROR 1143 (42000): UPDATE command denied to user 'yaya'@'192.168.4.51' for column 'password' in table 'user'
MySQL [(none)]> 
MySQL [(none)]> 
MySQL [(none)]> update  db3.user set uid=1 ;
Query OK, 22 rows affected (0.05 sec)
Rows matched: 23  Changed: 22  Warnings: 0

MySQL [(none)]> select uid  from db3.user;
+------+
| uid  |
+------+
|    1 |
|    1 |
|    1 |

总结： 可以通过 查看表记录可以获取用户权限  ，也可以通过更新记录，修改用户权限。
