1 用户授权：
		定义：使用数据库管理登录后，添加新的用户 并设置访问权限及登录密码
		      （默认只有数据库管理员root 用户可以 本机自己访问自己）
	
		命令格式： grant 
 grant 权限列表 on  数据库名  to  用户名@"客户端地址" identified by  "密码"  [ with grant option]；
 

		参数介绍
			权限列表 (可以执行的命令 命令之间是有,间隔)
			数据库名的表示方式?
			用户名  客户端访问数据库服务器时使用的名字 自定义即可，存储在mysql库下的user表里。
 
			客户端地址的表示方式 ？

			identified by   连接密码（要符合密码策略）
                        with grant option  可选项， 让新添加的用户有使用grant命令的权限

                例子

  grant  all   on  db1.*   to  admin@"%"  identified by "123qqq...A";

  
 客户端使用授权用户连接数据库服务器
 ]# which mysql
 ]# mysql -h数据库服务器ip地址 -u授权用户名  -p密码



 ++++++++++
添加用户mydba，对所有库、表有完全权限允许从任何客户端连接，密码123qqq…A 且有授权权限

 grant all on  *.*  to mydba@"%" identified by "123qqq...A" with grant option ;


+++++++++++ 练习到 11:40
添加admin用户，允许从192.168.4.0/24网段连接，对db3库的user表有查询权限，密码123qqq…A

mysql> grant select  on  db3.user  to  admin@"192.168.4.%" identified by "123qqq...A" ;

添加admin2用户，允许从本机连接，允许对db3库的所有表有查询/更新/插入/删除记录权限，密码123qqq…A
mysql> grant select,insert,update,delete on db3.* to admin2@"localhost" identified by "123qqq...A";

                相关命令
                        删除授权用户
                        drop user 用户名@"客户端地址"；
                        登录用户查看自己的访问权限 show grants;

                        查看服务器已有的授权用户
                      select user , host  from mysql.user;

mysql> select user  , host  from mysql.user;
+-----------+-------------+
| user      | host        |
+-----------+-------------+
| admin     | %           |
| mydba     | %           |
| admin     | 192.168.4.% |
| admin2    | localhost   |
| mysql.sys | localhost   |
| root      | localhost   |
+-----------+-------------+
6 rows in set (0.00 sec)

mysql>

                        管理员查看已有授权用户权限

mysql> show grants for mydba@"%";
mysql>

                        授权用户登录后修改自己的连接密码

[root@host51 ~]# mysql  -h192.168.4.50 -uadmin  -p123qqq...A
MySQL [(none)]> select  password("456qqq...B");
+-------------------------------------------+
| password("456qqq...B")                    |
+-------------------------------------------+
| *5CD115DAC51FB57FD4F6AF18A3AB8B91642A7601 |
+-------------------------------------------+
1 row in set, 1 warning (0.00 sec)

                   管理员重置授权用户连接密码
[root@host50 ~]# mysql -uroot -p123qqq...A
mysql> set password for admin@"192.168.4.%"=password("123qqq...A");
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql>
[root@host51 ~]# mysql  -h192.168.4.50 -uadmin  -p456qqq...B
ERROR 1045 (28000): Access denied for user 'admin'@'192.168.4.51' (using password: YES)
[root@host51 ~]#
[root@host51 ~]# mysql  -h192.168.4.50 -uadmin  -p123qqq...A
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 13
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]>


++++++++++++++++++++++++++++mysql库 记录授权信息，主要表如下：

              +++++++++++++++++  user表  记录已有的授权用户及权限（all  *.*）

select user from mysql.user;

select  host , user  from mysql.user;

select  * from mysql.user where  user="mydba" and host="%"  \G

show grants for mydba@"%" ;

mysql> update mysql.user set  Grant_priv="N" where  user="mydba" and host="%";
Query OK, 1 row affected (0.05 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for mydba@"%";
+--------------------------------------------+
| Grants for mydba@%                         |
+--------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'mydba'@'%' |
+--------------------------------------------+
1 row in set (0.00 sec)

mysql> select * from mysql.user where  host="%" and user="mydba" \G
*************************** 1. row ***************************
                  Host: %
                  User: mydba
           Select_priv: Y
           Insert_priv: Y
           Update_priv: Y
           Delete_priv: Y
           Create_priv: Y
             Drop_priv: Y
           Reload_priv: Y
         Shutdown_priv: Y
      Lock_tables_priv: Y
          Execute_priv: Y
       Repl_slave_priv: Y
      Repl_client_priv: Y
      Create_view_priv: Y
        Show_view_priv: Y
   Create_routine_priv: Y
    Alter_routine_priv: Y
      Create_user_priv: Y
            Event_priv: Y
          Trigger_priv: Y
Create_tablespace_priv: Y
              ssl_type:
            ssl_cipher:
           x509_issuer:
          x509_subject:
         max_questions: 0
           max_updates: 0
       max_connections: 0
  max_user_connections: 0
                plugin: mysql_native_password
 authentication_string: *F19C699342FA5C91EBCF8E0182FB71470EB2AF30
      password_expired: N
 password_last_changed: 2020-06-22 18:33:32
     password_lifetime: NULL
        account_locked: N
1 row in set (0.01 sec)

mysql

mysql> update  mysql.user set select_priv="N" , delete_priv="N"
    -> where user="mydba" and host="%";
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for mydba@"%";
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Grants for mydba@%                                                                                                                                                                                                                                                                                                                      |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| GRANT INSERT, UPDATE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE ON *.* TO 'mydba'@'%' |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> 


+++++++++++++++++++

db表                    记录已有授权用户对数据库的访问权限 (库名.*) db3.*

mysql> desc mysql.db;
mysql> select host , user , db  from mysql.db;
+-----------+-----------+-----+
| host      | user      | db  |
+-----------+-----------+-----+
| localhost | admin2    | db3 |
| localhost | mysql.sys | sys |
+-----------+-----------+-----+
2 rows in set (0.00 sec)

mysql> select *  from mysql.db where db="db3" \G
*************************** 1. row ***************************
                 Host: localhost
                   Db: db3
                 User: admin2
          Select_priv: Y
          Insert_priv: Y
          Update_priv: Y
          Delete_priv: Y
          Create_priv: N
            Drop_priv: N
           Grant_priv: N
      References_priv: N
           Index_priv: N
           Alter_priv: N
Create_tmp_table_priv: N
     Lock_tables_priv: N
     Create_view_priv: N
       Show_view_priv: N
  Create_routine_priv: N
   Alter_routine_priv: N
         Execute_priv: N
           Event_priv: N
         Trigger_priv: N
1 row in set (0.00 sec)

mysql> show grants for admin2@"localhost";
+-------------------------------------------------------------------------+
| Grants for admin2@localhost                                             |
+-------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin2'@'localhost'                              |
| GRANT SELECT, INSERT, UPDATE, DELETE ON `db3`.* TO 'admin2'@'localhost' |
+-------------------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>
mysql> update mysql.db set  delete_priv="N" where db="db3";
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush  privileges;
Query OK, 0 rows affected (0.00 sec)

mysql>
mysql> show grants for admin2@"localhost";
+-----------------------------------------------------------------+
| Grants for admin2@localhost                                     |
+-----------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin2'@'localhost'                      |
| GRANT SELECT, INSERT, UPDATE ON `db3`.* TO 'admin2'@'localhost' |
+-----------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>
mysql> select  * from mysql.db where db="db3" \G
*************************** 1. row ***************************
                 Host: localhost
                   Db: db3
                 User: admin2
          Select_priv: Y
          Insert_priv: Y
          Update_priv: Y
          Delete_priv: N
          Create_priv: N
mysql> show grants for admin2@"localhost";
+-----------------------------------------------------------------+
| Grants for admin2@localhost                                     |
+-----------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin2'@'localhost'                      |
| GRANT SELECT, INSERT, UPDATE ON `db3`.* TO 'admin2'@'localhost' |
+-----------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>
mysql> select  * from mysql.db where db="db3" \G
*************************** 1. row ***************************
                 Host: localhost
                   Db: db3
                 User: admin2
          Select_priv: Y
          Insert_priv: Y
          Update_priv: Y
          Delete_priv: N
          Create_priv: N
            Drop_priv: N
           Grant_priv: N
      References_priv: N
           Index_priv: N
           Alter_priv: N
Create_tmp_table_priv: N
     Lock_tables_priv: N
     Create_view_priv: N
       Show_view_priv: N
  Create_routine_priv: N
   Alter_routine_priv: N
         Execute_priv: N
           Event_priv: N
         Trigger_priv: N
1 row in set (0.00 sec)

mysql>

++++++++++++++++++++++++++++++++++++++++
tables_priv表   记录已有授权用户对表的访问权限  (库名.表名) db1.stu

mysql> select  user , db, table_name from  mysql.tables_priv ;
+-----------+-----+------------+
| user      | db  | table_name |
+-----------+-----+------------+
| admin     | db3 | user       |
| mysql.sys | sys | sys_config |
+-----------+-----+------------+
2 rows in set (0.00 sec)

mysql> select  host ,user , db, table_name from  mysql.tables_priv ;
+-------------+-----------+-----+------------+
| host        | user      | db  | table_name |
+-------------+-----------+-----+------------+
| 192.168.4.% | admin     | db3 | user       |
| localhost   | mysql.sys | sys | sys_config |
+-------------+-----------+-----+------------+
2 rows in set (0.00 sec)

mysql> select  * from  mysql.tables_priv where db="db3" and table_name="user" ;
mysql> select  * from  mysql.tables_priv where db="db3" and table_name="user" ;
+-------------+-----+-------+------------+----------------+---------------------+------------+-------------+
| Host        | Db  | User  | Table_name | Grantor        | Timestamp           | Table_priv | Column_priv |
+-------------+-----+-------+------------+----------------+---------------------+------------+-------------+
| 192.168.4.% | db3 | admin | user       | root@localhost | 0000-00-00 00:00:00 | Select     |             |
+-------------+-----+-------+------------+----------------+---------------------+------------+-------------+
1 row in set (0.00 sec)

mysql> show grants for admin@"192.168.4.%";
+-------------------------------------------------------+
| Grants for admin@192.168.4.%                          |
+-------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin'@'192.168.4.%'           |
| GRANT SELECT ON `db3`.`user` TO 'admin'@'192.168.4.%' |
+-------------------------------------------------------+
2 rows in set (0.00 sec)

mysql>


mysql> update mysql.tables_priv set  table_priv="select,insert,update" where db="db3" and table_name="user";
Query OK, 1 row affected (0.03 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for admin@"192.168.4.%";
+-----------------------------------------------------------------------+
| Grants for admin@192.168.4.%                                          |
+-----------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'admin'@'192.168.4.%'                           |
| GRANT SELECT, INSERT, UPDATE ON `db3`.`user` TO 'admin'@'192.168.4.%' |
+-----------------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql> select  * from  mysql.tables_priv where db="db3" and table_name="user" ;
+-------------+-----+-------+------------+----------------+---------------------+----------------------+-------------+
| Host        | Db  | User  | Table_name | Grantor        | Timestamp           | Table_priv           | Column_priv |
+-------------+-----+-------+------------+----------------+---------------------+----------------------+-------------+
| 192.168.4.% | db3 | admin | user       | root@localhost | 2020-06-22 23:49:14 | Select,Insert,Update |             |
+-------------+-----+-------+------------+----------------+---------------------+----------------------+-------------+
1 row in set (0.00 sec)

mysql>

++++++++++++++++++++++++=
columns_priv表  记录已有授权用户对字段的访问权限 update(name,age)

mysql> select  * from  mysql.columns_priv;
Empty set (0.00 sec)

mysql> desc  mysql.columns_priv;


mysql> grant  select , update(name,uid) on db3.user to yaya@"%" identified by "123qqq...A";
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> select  * from  mysql.columns_priv;
+------+-----+------+------------+-------------+---------------------+-------------+
| Host | Db  | User | Table_name | Column_name | Timestamp           | Column_priv |
+------+-----+------+------------+-------------+---------------------+-------------+
| %    | db3 | yaya | user       | name        | 0000-00-00 00:00:00 | Update      |
| %    | db3 | yaya | user       | uid         | 0000-00-00 00:00:00 | Update      |
+------+-----+------+------------+-------------+---------------------+-------------+
2 rows in set (0.00 sec)

mysql> mysql> select  * from  mysql.tables_priv;
+-------------+-----+-----------+------------+----------------+---------------------+----------------------+-------------+
| Host        | Db  | User      | Table_name | Grantor        | Timestamp           | Table_priv           | Column_priv |
+-------------+-----+-----------+------------+----------------+---------------------+----------------------+-------------+
| localhost   | sys | mysql.sys | sys_config | root@localhost | 2020-06-19 17:29:39 | Select               |             |
| %           | db3 | yaya      | user       | root@localhost | 0000-00-00 00:00:00 | Select               | Update      |
| 192.168.4.% | db3 | admin     | user       | root@localhost | 2020-06-22 23:49:14 | Select,Insert,Update |             |
+-------------+-----+-----------+------------+----------------+---------------------+----------------------+-------------+
3 rows in set (0.00 sec)

mysql>

MySQL [(none)]> update  db3.user set password="F" ;
ERROR 1143 (42000): UPDATE command denied to user 'yaya'@'192.168.4.51' for column 'password' in table 'user'
MySQL [(none)]> 
MySQL [(none)]> 
MySQL [(none)]> update  db3.user set uid=1 ;
Query OK, 22 rows affected (0.05 sec)
Rows matched: 23  Changed: 22  Warnings: 0

MySQL [(none)]> select uid  from db3.user;
+------+
| uid  |
+------+
|    1 |
|    1 |
|    1 |

总结： 可以通过 查看表记录可以获取用户权限  ，也可以通过更新记录，修改用户权限。


++++++++++++++++++++++++++++++++++=

                撤销用户权限
                命令格式
                        mysql> revoke  权限列表  on  库名.表   from     用户名@"客户端地址";

                例子


mysql> select  host , user  from mysql.user;
+-------------+-----------+
| host        | user      |
+-------------+-----------+
| %           | mydba     |
| %           | yaya      |
| 192.168.4.% | admin     |
| localhost   | admin2    |
| localhost   | mysql.sys |
| localhost   | root      |
+-------------+-----------+
6 rows in set (0.00 sec)

mysql> show grants  for  mydba@"%";
1 row in set (0.00 sec)

mysql> revoke INSERT, UPDATE, CREATE, DROP on *.*  from mydba@"%";
Query OK, 0 rows affected (0.00 sec)

mysql>

mysql>
mysql> show grants  for  mydba@"%";
1 row in set (0.00 sec)

mysql>
mysql> revoke all on *.*  from mydba@"%";
Query OK, 0 rows affected (0.00 sec)

mysql> show grants  for  mydba@"%";
+-----------------------------------+
| Grants for mydba@%                |
+-----------------------------------+
| GRANT USAGE ON *.* TO 'mydba'@'%' |
+-----------------------------------+
1 row in set (0.00 sec)

mysql>

mysql> select  * from  mysql.user where  user="mydba" and host="%" \G
*************************** 1. row ***************************
                  Host: %
                  User: mydba
           Select_priv: N
           Insert_priv: N
           Update_priv: N
           Delete_priv: N
           Create_priv: N
             Drop_priv: N
           Reload_priv: N
         Shutdown_priv: N
          Process_priv: N
             File_priv: N
            Grant_priv: N
       References_priv: N
            Index_priv: N
            Alter_priv: N
          Show_db_priv: N
1026 
1027 mysql> select  * from mysql.tables_priv where db="db3" and  user="admin" ;
1028 +-------------+-----+-------+------------+----------------+---------------------+---------------+-------------+
1029 | Host        | Db  | User  | Table_name | Grantor        | Timestamp           | Table_priv    | Column_priv |
1030 +-------------+-----+-------+------------+----------------+---------------------+---------------+-------------+
1031 | 192.168.4.% | db3 | admin | user       | root@localhost | 2020-06-22 23:49:14 | Insert,Update |             |
1032 +-------------+-----+-------+------------+----------------+---------------------+---------------+-------------+
1033 1 row in set (0.00 sec)
1034 
1035 mysql>
1036 
1037 
1038 mysql> grant all on  *.*  to  plj@"%" identified by "123qqq...A" with  grant option ;
1039 Query OK, 0 rows affected, 1 warning (0.00 sec)
1040 
1041 mysql> show grants   for  plj@"%";
1042 +------------------------------------------------------------+
1043 | Grants for plj@%                                           |
1044 +------------------------------------------------------------+
1045 | GRANT ALL PRIVILEGES ON *.* TO 'plj'@'%' WITH GRANT OPTION |
1046 +------------------------------------------------------------+
1047 1 row in set (0.00 sec)
1048 
1049 mysql> revoke grant option on  *.*  from   plj@"%";  仅撤销用户的授权权限
1050 Query OK, 0 rows affected (0.00 sec)
1051 
1052 mysql> show grants   for  plj@"%";
1053 +------------------------------------------+
1054 | Grants for plj@%                         |
1055 +------------------------------------------+
1056 | GRANT ALL PRIVILEGES ON *.* TO 'plj'@'%' |
1057 +------------------------------------------+
1058 1 row in set (0.00 sec)
1059 
1060 mysql>
1061 
1062 mysql> revoke delete , drop  on  *.*  from   plj@"%"; 撤销用户对库表的部分访问权限
1063 
1064 mysql> revoke all on  *.*  from   plj@"%";   撤销用户库表的当前所有权限权限
1065 Query OK, 0 rows affected (0.00 sec)
1066 
1067 mysql> show grants   for  plj@"%";
1068 +---------------------------------+
1069 | Grants for plj@%                |
1070 +---------------------------------+
1071 | GRANT USAGE ON *.* TO 'plj'@'%' |
1072 +---------------------------------+
1073 1 row in set (0.00 sec)
1074 
1075 mysql>

++++++++++++++++++++++++++++++++++

        密码管理
                修改数据库管理员root用户本机登录密码(操作系统管理员有权限修改)

[root@mysql50 ~]# mysqladmin -hlocalhost -uroot -p123qqq...A   password "A...qqq321"
mysqladmin: [Warning] Using a password on the command line interface can be insecure.
Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.


[root@mysql50 ~]# mysql -uroot -p123qqq...A
mysql: [Warning] Using a password on the command line interface can be insecure.
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
[root@mysql50 ~]#

[root@mysql50 ~]# mysql -uroot -pA...qqq321
mysql>


                恢复数据库管理员root用户本机登录密码(操作系统管理员有权限)
                 步骤如下：
1. 停止MySQL服务程序
[root@mysql50 ~]# systemctl  stop mysqld

2. 跳过授权表启动MySQL服务程序
[root@mysql50 ~]# vim /etc/my.cnf
[mysqld]
skip_grant_tables
#validate_password_length = 6
#validate_password_policy = 0
:wq
[root@mysql50 ~]# systemctl  start mysqld

3. 修改root密码
mysql> select  host , user , authentication_string  from  mysql.user;
+-------------+-----------+-------------------------------------------+
| host        | user      | authentication_string                     |
+-------------+-----------+-------------------------------------------+
| localhost   | root      | *70F9D506F072C3311E4A5B6C4AB3C8865D69EF7D |
| localhost   | mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |
| %           | yaya      | *F19C699342FA5C91EBCF8E0182FB71470EB2AF30 |
| %           | plj       | *F19C699342FA5C91EBCF8E0182FB71470EB2AF30 |
| 192.168.4.% | admin     | *F19C699342FA5C91EBCF8E0182FB71470EB2AF30 |
| localhost   | admin2    | *F19C699342FA5C91EBCF8E0182FB71470EB2AF30 |
+-------------+-----------+-------------------------------------------+
6 rows in set (0.00 sec)

mysql> update mysql.user set authentication_string=password("666qqq...B") where user="root" and host="localhost";
Query OK, 1 row affected, 1 warning (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 1

mysql> flush privileges;
Query OK, 0 rows affected (0.08 sec)

Bye
[root@mysql50 ~]#


4. 以正常方式重启MySQL服务程序
vim /etc/my.cnf
[mysqld]
#skip_grant_tables
validate_password_length = 6
validate_password_policy = 0
:wq

5 使用修改后的密码登陆
[root@mysql50 ~]# mysql -uroot -p666qqq...B
mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>



一、用户授权
    1.1  用户授权定义
    1.2  命令格式
    1.3  参数介绍
    1.4  客户端连接数据库服务的命令格式  ]# mysql  -h服务器IP  -u用户名  -p密码
    1.5  相关命令
    1.6  授权库mysql (记录授权信息)
    1.7  撤销用户权限
    1.8  root密码管理


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
物理备份
[root@host50 ~]# tar -zcvf  /opt/mysql.tar.gz   /var/lib/mysql/*
[root@host50 ~]# cp  -r /var/lib/mysql   /opt/mysql.bak

[root@host50 ~]# ls /opt/
mysql.bak  mysql.tar.gz
[root@host50 ~]#

[root@host50 ~]# scp -r /opt/mysql.bak  root@192.168.4.51:/tmp/

物理恢复数据的步骤

[root@host51 ~]# chown  -R mysql:mysql /var/lib/mysql

[root@host51 ~]# setenforce 0


[root@host51 ~]# systemctl  start mysqld

[root@host51 ~]# netstat  -utnlp  | grep  3306
tcp6       0      0 :::3306                 :::*                    LISTEN      1976/mysqld
        把备份的目录拷贝到 /var/lib  目录下
        修改所有者和组用户为mysql
        启动mysqld数据库服务
        数据库管理员root用户登录 查看数据

[root@host51 ~]# systemctl  stop mysqld
[root@host51 ~]#
[root@host51 ~]# rm -rf /var/lib/mysql


[root@host51 ~]# cp -r /tmp/mysql.bak /var/lib/mysql

[root@host51 ~]# chown  -R mysql:mysql /var/lib/mysql

[root@host51 ~]# setenforce 0


[root@host51 ~]# systemctl  start mysqld

[root@host51 ~]# netstat  -utnlp  | grep  3306
tcp6       0      0 :::3306                 :::*                    LISTEN      1976/mysqld
[root@host51 ~]#

[root@host51 ~]# mysql -uroot -p666qqq...B
mysql> show databases;

++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++数据的完全备份与恢复 之  mysqldump
完全备份命令格式
]# mysqldump -uroot  -p密码  数据库名   >  目录名/文件名.sql

数据库名的表示方式 ？

                     时间 到 11:50
]# mkdir /mybak
]# mysqldump  -uroot -p666qqq...B  --all-databases  >  /mybak/all.sql
]# mysqldump  -uroot -p666qqq...B  db1  >  /mybak/db1.sql
]# mysqldump  -uroot -p666qqq...B -B db1 db3 >  /mybak/twodb.sql
]# mysqldump  -uroot -p666qqq...B  db3 user >  /mybak/db3_user.sql
]# scp   /mybak/db1.sql  root@192.168.4.51:/root/
恢复数据的命令格式

]# mysql -uroot -p密码  库名   <  目录名/文件名.sql
[root@host51 ~]# mysql -uroot -p666qqq...B
mysql> drop table db3.t3;

[root@host51 ~]# mysql -uroot -p666qqq...B  db1  < /root/db1.sql 
mysql: [Warning] Using a password on the command line interface can be insecure.
ERROR 1049 (42000): Unknown database 'db1'
[root@host51 ~]# 
[root@host51 ~]# 
[root@host51 ~]# mysql -uroot -p666qqq...B  -e 'create database db1'
mysql: [Warning] Using a password on the command line interface can be insecure.
[root@host51 ~]# 
[root@host51 ~]# mysql -uroot -p666qqq...B  -e 'show databases'
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------------+
| Database           |
+--------------------+
| information_schema |
| db1                |
| db3                |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
[root@host51 ~]# mysql -uroot -p666qqq...B  db1  < /root/db1.sql 
mysql: [Warning] Using a password on the command line interface can be insecure.
[root@host51 ~]# 
[root@host51 ~]# mysql -uroot -p666qqq...B  -e 'show databases '
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------------+
| Database           |
+--------------------+
| information_schema |
| db1                |
| db3                |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
[root@host51 ~]# mysql -uroot -p666qqq...B  -e 'use db1; show tables '
mysql: [Warning] Using a password on the command line interface can be insecure.
+---------------+
| Tables_in_db1 |
+---------------+
| gz            |
| t22           |
| t23           |
| t24           |
| yg            |
+---------------+
[root@host51 ~]# 

+++++++++++++++++++++++++++++++
增量备份 之 binlog日志
                1 掌握binlog日志的使用
                        1.1 binlog日志介绍 ？
                        1.2 启用binlog日志 (时间 5分钟 到 15:51)
]# vim /etc/my.cnf
   [mysqld]
     server_id=50
     log_bin
mysql>

                        
                        自定义日志文件存放目录和日志文件名  练习+休息到 15:15
]# vim /etc/my.cnf
[mysqld]
server_id=50
#log_bin
log_bin=/mylog/plj                
:wq

[root@host50 mysql]# mkdir /mylog
[root@host50 mysql]# chown  mysql /mylog
[root@host50 mysql]# setenforce  0
[root@host50 mysql]#  
[root@host50 mysql]# systemctl  restart mysqld
[root@host50 mysql]#
[root@host50 mysql]# ls /var/lib/mysql/*-bin*
/var/lib/mysql/host50-bin.000001  /var/lib/mysql/host50-bin.index
[root@host50 mysql]#
[root@host50 mysql]# ls /mylog/
plj.000001  plj.index
[root@host50 mysql]# mysql -uroot -p666qqq...B -e 'show master status '
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------+----------+--------------+------------------+-------------------+
| File       | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------+----------+--------------+------------------+-------------------+
| plj.000001 |      154 |              |                  |                   |
+------------+----------+--------------+------------------+-------------------+
[root@host50 mysql]#


[root@host50 mysql]# mysqlbinlog /mylog/plj.000001   查看日志文件内容

                手动创建新的日志文件的方式
                        [root@host50 mylog]# systemctl  restart mysqld

                     
                        [root@host50 mylog]# mysql -uroot -p666qqq...B  -e 'flush logs'
                        等效于
                        mysql> flush logs;

                        [root@host50 mylog]# mysqldump -uroot -p666qqq...B  --flush-logs  db3 user > /root/user.sql

                删除已有的日志
                        mysql> system ls /mylog
plj.000001  plj.000003  plj.000005  plj.000007  plj.000009  plj.000011  plj.index
plj.000002  plj.000004  plj.000006  plj.000008  plj.000010  plj.000012
mysql>
mysql> purge  master  logs  to  "plj.000006" ;
Query OK, 0 rows affected (0.00 sec)

mysql> system ls /mylog
plj.000006  plj.000007  plj.000008  plj.000009  plj.000010  plj.000011  plj.000012  plj.index
mysql>
mysql> system cat /mylog/plj.index
/mylog/plj.000006
/mylog/plj.000007
/mylog/plj.000008
/mylog/plj.000009
/mylog/plj.000010
/mylog/plj.000011
/mylog/plj.000012
/mylog/plj.000013
mysql>

mysql> reset master ;
Query OK, 0 rows affected, 1 warning (0.01 sec)

mysql> system ls /mylog
plj.000001  plj.index
mysql>
mysql> show master status;
+------------+----------+--------------+------------------+-------------------+
| File       | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------+----------+--------------+------------------+-------------------+
| plj.000001 |      154 |              |                  |                   |
+------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)

mysql> system cat /mylog/plj.index
/mylog/plj.000001
mysql>