#######DBA1_DAY04######
一 用户授权
   1.1 用户授权介绍（啥是用户授权）添加用户给客户端连接使用。默认只有root
   能从本机连接MySQL服务。
  
   1.2 用户授权的命令格式？
   ]#mysql -uroot -p密码
   mysql>  grant  权限列表 on 库名  to   用户名@“客户端地址”  
           identified by "密码"  [with grant option] ; 

    权限列表 的表示方式 ：
	         all 		   
             select , insert , update 
			 insert(name),update(age,uid)
			 usage 
	库名的表示方式 ：
			*.*
			库名.* 
			库名.表        
	客户端地址的表示方式 ：	
			localhost
			%
			192.168.4.%
			192.168.4.200
	密码 要符合服务器的密码策略		
	
	with grant option 可选项，让添加的用户可以使用grant命令 再填用户		
	
授权练习
host50]# 添加root用户
mysql> grant all on *.* to root@"192.168.4.51"
       identified by "123qqq...A" with grant option;
	  
	  测试添加的root 用户
host51]# mysql -h192.168.4.50 -uroot -p123qqq...A
mysql> 可以执行所有的sql命令
mysql> grant all on *.*  to mydba@"%" 
identified by "123qqq...A" with grant option;
mysql> exit

测试 添加的mydba用户
[root@host50 ~]# mysql -umydba -p123qqq...A
[root@host51 ~]# mysql -h192.168.4.50  -umydba -p123qqq...A
	
	
	在host50 添加 admin用户 
MySQL> grant  select on  db3.user to admin@"192.168.4.%"
identified by "123qqq...A";

    在51主机测试
host51]# mysql -h192.168.4.50 -uadmin -p123qqq...A
mysql> show databases;
mysql> use db3;
mysql> delete from db3.user; 报错
mysql> select  * from  db3.user; 正确

   在host50 添加 admin2用户
 MySQL> grant  select,insert,update,delete on db1.*  to admin2@"localhost"
 identified by "123qqq...A";
 
   在51主机测试
host51]# mysql -h192.168.4.50 -uadmin2 -p123qqq...A  报错
    
   在50主机测试
host50]# mysql  -uadmin2 -p123qqq...A  成功
mysql> create table db1.t30(id int);  报错
mysql> select  * from db1.t2; 可以

掌握与用户相关的命令：
	查看服务器已有用户
mysql> select host ,user from mysql.user;
	
	查看已有用户的访问权限
mysql> show grants for root@"192.168.4.51";	
	
	程序员把连接用的密码忘记了怎么办(数据库运维重置用户的登录密码)
set password for mydba@"%"=password("密码");	
	
	怎么知道当前连接服务器的用户是谁 select user();
	
	显示当前连接服务器的用户有什么样的访问权限 show grants;
	
	程序怎么修改连接数据库服务器用户的密码
	mysql> set password=password("123qqq...A");

	怎么删除添加的用户
	drop user  mydba@"%" ;
	
   1.3 撤销权限 （库名 和  用户 客户地址  必须和授权时一样 ）
       命令格式  revoke 权限列表 on 库名 from 用户@“客户端地址”；

       
show grants for root@"192.168.4.51"; 查看用户已有的权限

revoke grant option on *.* from root@"192.168.4.51"；只撤销用户的with grant option权限
   
revoke delete on *.* from root@"192.168.4.51"; 撤销用户删除记录的delete权限  
 
revoke all on *.* from root@"192.168.4.51";撤销当前已有的所有权限 

    给已有用户添加新权限？
mysql> grant select on db3.user to yaya@"%" identified by "123qqq...A";
mysql> show grants for yaya@"%";

mysql> grant insert,update(name,gid) on db3.user to yaya@"%";
mysql> show grants for yaya@"%";

mysql> grant grant option on db3.user to yaya@"%";
mysql> show grants for yaya@"%";	

mysql> grant all on db1.* to yaya@"%";


    给用户设置了with grant option 权限后，就能添加用户吗 ？	
	还必须对mysql库下的表有insert 的权限 才可以
    
mysql> grant insert on mysql.* to yaya@"%";
	
在51主机测试	   
host51]# mysql  -h192.168.4.50 -uyaya -p123qqq...A
 mysql> grant select on db3.user to jing@"%" identified by "123qqq...A";
 mysql> grant select on db3.user to yaya1@"localhost" 
    -> identified by "123qqq...A";

在50 查看是否多了新用yaya1
mysql> select host ,user from mysql.user where user="yaya1";

 
   1.4 授权库mysql库的使用

权限列表：
 SELECT, INSERT, UPDATE, delete , CREATE, DROP, RELOAD, 
 SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, 
 SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, 
 LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, 
 CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, 
 CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE

   1.5 root密码管理
操作系统管理员  修改数据库服务器root用户本机登录密码
]# mysqladmin -uroot -p旧密码  password "新密码"
  
]# mysqladmin -uroot -p123qqq...A  password "A...qqq321"

隐藏密码修改
[root@host50 ~]# mysqladmin -uroot -p  password 
Enter password: 旧密码
Enter password: 新密码

破解库管理员root用户本机登录密码，具体操作如下：
			修改数据库服务运行参数
			]# vim /etc/my.cnf
			[mysqld]
            skip-grant-tables
			如果修改了密码策略 要注释掉
			#
			#
			:wq
			
			重启数据库服务
			]# systemctl  restart mysqld
			
			无密码登录 ]#mysql
			修改密码
mysql> update  mysql.user  
set  authentication_string=password("789...qqqA") 
where host="localhost" and user="root";
mysql> flush privileges;

           断开连接mysql> exit
		
			注释修改的运行参数
     ]# vim /etc/my.cnf
			[mysqld]
            #skip-grant-tables
			如果想密码策略 去掉注释掉
			:wq
			
			重启数据库服务
			]# systemctl  restart mysqld			
			
			使用修改的密码登录
			mysql -uroot -p789...qqqA
			


